<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Configuring ReDex · Redex</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="ReDex can be configured to run different optimizations or to alter the behavior"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Configuring ReDex · Redex"/><meta property="og:type" content="website"/><meta property="og:url" content="https://fbredex.com/"/><meta property="og:description" content="ReDex can be configured to run different optimizations or to alter the behavior"/><meta property="og:image" content="https://fbredex.com/img/og_image.png"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/redex.png" alt="Redex"/><h2 class="headerTitleWithLogo">Redex</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/installation" target="_self">Docs</a></li><li class="siteNavGroupActive"><a href="/docs/faq" target="_self">FAQ</a></li><li class=""><a href="https://code.facebook.com/posts/1480969635539475/optimizing-android-bytecode-with-redex" target="_self">Birth</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Getting Started</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/installation">Installation</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/configuring">Configuring ReDex</a></li><li class="navListItem"><a class="navItem" href="/docs/passes">Passes</a></li><li class="navListItem"><a class="navItem" href="/docs/usage">Usage</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Examples</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/proguard">Using ProGuard Rules with Redex</a></li><li class="navListItem"><a class="navItem" href="/docs/synth">Redex Synth Pass Example</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Technical Details</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/docker">Docker Container Deployments</a></li><li class="navListItem"><a class="navItem" href="/docs/interdex">Interdex</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Help</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/faq">FAQ</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Configuring ReDex</h1></header><article><div><span><p>ReDex can be configured to run different optimizations or to alter the behavior
of existing optimizations.  While this isn't always necessary, it's helpful to
be able to tweak settings to get the best results.</p>
<h1><a class="anchor" aria-hidden="true" id="a-simple-example"></a><a href="#a-simple-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A Simple Example</h1>
<p>A starting point for configuration is to use a configuration similar to the
default config that's baked in to the <code>redex</code> binary.  You can find this config
in <a href="https://github.com/facebook/redex/blob/master/config/default.config">config/default.config</a>.  This is what it looks like:</p>
<pre><code class="hljs">{
<span class="hljs-attr">"redex"</span> : {
  <span class="hljs-attr">"passes"</span> : [
    <span class="hljs-string">"ReBindRefsPass"</span>,
    <span class="hljs-string">"BridgeSynthInlinePass"</span>,
    <span class="hljs-string">"FinalInlinePassV2"</span>,
    <span class="hljs-string">"DelSuperPass"</span>,
    <span class="hljs-string">"SingleImplPass"</span>,
    <span class="hljs-string">"MethodInlinePass"</span>,
    <span class="hljs-string">"StaticReloPassV2"</span>,
    <span class="hljs-string">"RemoveEmptyClassesPass"</span>,
    <span class="hljs-string">"ShortenSrcStringsPass"</span>,
    <span class="hljs-string">"RegAllocPass"</span>
  ]
}
}
</code></pre>
<p>Name this file default.config, and invoke <code>redex</code> with it:</p>
<pre><code class="hljs">% redex.py -c default.<span class="hljs-built_in">config</span> -o tmp/<span class="hljs-built_in">output</span>.apk <span class="hljs-built_in">input</span>.apk
</code></pre>
<p>This will do... exactly what redex does without the config.  Not so exciting, is
it?  Let's move on to something more advanced.</p>
<h1><a class="anchor" aria-hidden="true" id="selecting-optimization-passes"></a><a href="#selecting-optimization-passes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Selecting Optimization Passes</h1>
<p>Changing the set of optimizations ReDex runs is easy; just add (or remove) the
pass name from the redex.passes list.  For example, let's say you want to remove
the ShortenSrcStrings optimization while you're debugging something.  Just use
this config:</p>
<pre><code class="hljs">{
<span class="hljs-attr">"redex"</span> : {
  <span class="hljs-attr">"passes"</span> : [
    <span class="hljs-string">"ReBindRefsPass"</span>,
    <span class="hljs-string">"BridgeSynthInlinePass"</span>,
    <span class="hljs-string">"FinalInlinePass"</span>,
    <span class="hljs-string">"DelSuperPass"</span>,
    <span class="hljs-string">"SingleImplPass"</span>,
    <span class="hljs-string">"MethodInlinePass"</span>,
    <span class="hljs-string">"RemoveEmptyClassesPass"</span>,
    <span class="hljs-string">"RegAllocPass"</span>
  ]
}
}
</code></pre>
<h1><a class="anchor" aria-hidden="true" id="configuring-optimization-behavior"></a><a href="#configuring-optimization-behavior" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring optimization behavior</h1>
<p>Each optimization pass has some configurable parameters that are specific to
that pass.  These are often blocklists (or allowlists) indicating what code the
optimization should leave alone (for blocklists) or what code should be
optimized (for allowlists).</p>
<p>A simple example is ShortenSrcStrings.  This pass removes filenames indicating
what source code produced each class.  It's a waste to ship those source strings
to production, but it's useful to be able to map the shortened names back to the
original names (e.g., for solving user bug reports).  You can tell
ShortenSrcStrings to produce this map by adding a config entry:</p>
<pre><code class="hljs"><span class="hljs-string">"redex"</span> : {
  <span class="hljs-string">"passes"</span> : [
    ShortenSrcStringsPass,
    <span class="hljs-string">"RegAllocPass"</span>
  ]
},
<span class="hljs-string">"ShortenSrcStringsPass"</span> : {
  <span class="hljs-string">"filename_mappings"</span> : "/<span class="hljs-type">tmp</span>/filename_mappings.txt<span class="hljs-string">"
}
</span></code></pre>
<p>Options for each pass are documented with that pass.</p>
<h1><a class="anchor" aria-hidden="true" id="global-options"></a><a href="#global-options" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Global options</h1>
<ul>
<li><p><code>redex.passes</code>
<strong>Type</strong>: array of strings
A list of passes to be run in the specified order.</p></li>
<li><p><code>coldstart_classes</code>
<strong>Type</strong>: string
Path to a file containing a list of class names in the order they are used
for cold start.  Example format:</p>
<pre><code class="hljs">com/foo/<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Bar</span>.</span></span><span class="hljs-keyword">class</span>
com/foo/<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Baz</span>.</span></span><span class="hljs-keyword">class</span><span class="hljs-operator">
...
</span>com/foo/<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Quux</span>.</span></span><span class="hljs-keyword">class</span>
</code></pre></li>
<li><p><code>proguard_map</code>
<strong>Type</strong>: string
Path to a file containing ProGuard's mapping of unobfuscated
class/field/method names to obfuscated names.  This option is useful if you
are running ReDex after ProGuard, so that ReDex will properly understand
obfuscated names.</p></li>
</ul>
<h1><a class="anchor" aria-hidden="true" id="complete-configuration"></a><a href="#complete-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Complete configuration</h1>
<p>To see the (almost) complete list of configuration parameters, run</p>
<pre><code class="hljs">redex-<span class="hljs-keyword">all</span> <span class="hljs-comment">--reflect-config</span>
</code></pre>
<p>(Note that you run <code>redex-all</code> here, not the <code>redex.py</code> wrapper!)</p>
<p>This emits a JSON document detailing parameters, their types, defaults and
possibly documentation.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 3/22/2023 by Sam Ken</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/installation"><span class="arrow-prev">← </span><span>Installation</span></a><a class="docs-next button" href="/docs/passes"><span>Passes</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/redex.png" alt="Redex" width="66" height="58"/></a><div class="footerSection"><h5>Docs</h5><a href="
                /docs/en/installation">Getting Started</a><a href="
                /docs/en/configuring">Configuring</a><a href="
                /docs/en/usage">Using</a><a href="
                /docs/en/faq">FAQ</a></div><div class="footerSection"><h5>Social</h5><div class="social"><a class="github-button" href="https://github.com/facebook/redex" data-count-href="https://github.com/facebook/redex/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">redex</a></div></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright"><span>Copyright © 2023 Meta Platforms Inc.</span></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '7ef33486bb9b0c17ed9a5dedb0da8e36',
                indexName: 'fbredex',
                inputSelector: '#search_input_react'
              });
            </script></body></html>